<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>AI Lab Assistant Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/navbar.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/sidebar.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/chat.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/components.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/banner.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/loader.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/responsive.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/mongodb-theme.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Add marked library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.3/purify.min.js"></script>
    <script src="{{ url_for('static', filename='js/feedback.js') }}"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            marked.setOptions({
                breaks: true, // This will render line breaks in Markdown
                gfm: true,    // GitHub Flavored Markdown
            });
            console.log('Marked library loaded:', typeof marked);
            console.log('Markdown test:', marked.parse('# Hello\n\nThis is a **test**.'));
        });
    </script>
</head>
<body>
    {% include 'navbar.html' %}
    {% if is_chat %}
    <div id="review-banner" class="review-banner">
        <i class="fas fa-pencil-alt"></i>
        <span>Book a Design Review - Have your app reviewed by MongoDB Experts</span>
        <button id="book-review-btn" class="btn btn-sm btn-light ml-2">Book Now</button>
        <div id="design-review-banner" class="design-review-banner">
            <i class="fas fa-pencil-alt"></i>
            <span>Request a Design Review - Have your app reviewed by MongoDB Experts</span>
            <button id="request-review-btn" class="btn btn-sm btn-light ml-2">Request Now</button>
        </div>
    </div>
    {% endif %}

    <div class="container-fluid">
        <div class="row">
            <!-- Chat interface -->
            {% if is_chat %}
            <div class="chat-page">
                <div class="chat-content">
                    <div id="chat-container" class="chat-container">
                        <!-- Messages will be dynamically inserted here -->
                    </div>
                </div>
                <div id="input-container" class="input-container">
                    <div id="autocomplete-dropdown" class="autocomplete-wrapper" style="display: none;"></div>
                    <div class="d-flex align-items-center w-100">
                        <div class="dropdown me-2">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="module-select" data-bs-toggle="dropdown" aria-expanded="false">
                              Select a Module
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="module-select">
                              <li><a class="dropdown-item" href="#" data-value="Atlas Setup">Atlas Setup</a></li>
                              <li><a class="dropdown-item" href="#" data-value="Data Modeling">Data Modeling</a></li>
                              <li><a class="dropdown-item" href="#" data-value="Aggregation Framework">Aggregation Framework</a></li>
                              <li><a class="dropdown-item" href="#" data-value="Atlas Search">Atlas Search</a></li>
                              <li><a class="dropdown-item" href="#" data-value="Atlas Vector Search">Atlas Vector Search</a></li>
                              <li><a class="dropdown-item" href="#" data-value="AI / RAG">AI / RAG</a></li>
                              <li><a class="dropdown-item" href="#" data-value="Library Management Application">Library Management Application</a></li>
                            </ul>
                          </div>
                        <input type="text" id="user-input" class="form-control me-2" placeholder="Type your question here..." aria-label="Text input with dropdown button">
                        <button id="send-button" class="btn btn-primary">Send</button>
                    </div>
                </div>
            <button id="sample-questions-fab" class="fab" title="Sample Questions">
                <i class="fas fa-question"></i>
            </button>

            <div id="sample-questions-modal" class="modal">
                <div class="modal-content">
                    <h2>Sample Questions</h2>
                    <button class="sample-question">Can't connect?</button>
                    <button class="sample-question">No books displaying?</button>
                    <button class="sample-question">Codespaces not working?</button>
                    <button class="sample-question">What is Atlas Search?</button>
                    <button class="sample-question">Should I embed or reference?</button>
                    <!-- Add more sample questions as needed -->
                </div>
            </div>
            {% else %}
            <!-- Home page content -->
            <div class="col-md-12 main-content">

                
                <div class="home-page">
                    <h1>Welcome to the AI Lab Assistant</h1>
                    <p>
                        The AI Lab Assistant is designed to help you with commonly encountered issues while working on
                        MongoDB projects.
                        Whether you're having trouble connecting to your MongoDB cluster, displaying data in your
                        application, or launching your GitHub codespace,
                        the AI Lab Assistant is here to provide guidance and solutions.
                    </p>
                    <h3>Key Features:</h3>
                    <ul>
                        <li><strong>Real-time Assistance:</strong> Get immediate help with common MongoDB issues through
                            our
                            chat interface.</li>
                        <li><strong>Sample Questions:</strong> Quickly access solutions to frequently asked questions
                            about
                            MongoDB setup and troubleshooting.</li>
                        <li><strong>Admin Panel:</strong> Admins can manage questions and review unanswered queries to
                            improve our knowledge base.</li>
                        <li><strong>Labs Access:</strong> Explore our developer labs to deepen your MongoDB knowledge
                            and
                            skills.</li>
                    </ul>
                    <h3>Get Involved</h3>
                    <p>We encourage you to fork the repository and review the code to gain a deeper understanding of how
                        MongoDB VectorSearch can be implemented to build a similar system.</p>
                    <p>Check out, or <a href="https://github.com/mongodb-developer/ai_lab_assistant_chat/fork">fork</a>
                        the
                        project on GitHub: <a href="https://github.com/mongodb-developer/ai_lab_assistant_chat/">AI Lab
                            Assistant Chat</a>.</p>
                    <p>By exploring the code and the design patterns used, you can learn how to create scalable and
                        efficient applications using MongoDB. Happy coding!</p>
                    <p>
                        <a href="{{ url_for('main.chat') }}" class="btn btn-primary">Start a Conversation</a>
                    </p>
                    <div class="alert alert-info" role="alert">
                        <strong>Note Regarding This Software:</strong> This system is in beta testing and may have bugs.
                        If
                        you encounter any issues, please notify your instructor.
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Button to open the Calendly modal -->
    <!-- <button class="btn btn-primary" id="book-review-btn">Book a Design Review - Have your app reviewed by MongoDB Experts</button> -->

    <!-- Modal for Calendly Widget -->
    <div class="modal fade" id="calendlyModal" tabindex="-1" aria-labelledby="calendlyModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="calendlyModalLabel">Book a Developer Design Review</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Calendly inline widget begin -->
            <div class="calendly-inline-widget" data-url="https://docs.google.com/forms/d/1ZtBnW2BE5DTQDJ7hpirikPe4yqTD_ELTuTOhPy134-U/viewform?edit_requested=true" style="min-width:320px;height:700px;"></div>
            <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
            <!-- Calendly inline widget end -->
          </div>
        </div>
      </div>
    </div>

    <!-- Feedback section
    <div class="container mt-5" id="feedback-container">
        <button id="close-feedback" class="close-feedback-btn">&times;</button>
        <h2>We value your feedback!</h2>
        <p>Please rate your experience with our assistant:</p>
        <div id="feedback-scale" class="d-flex justify-content-center">
            <button class="feedback-button" data-value="1">😡</button>
            <button class="feedback-button" data-value="2">😟</button>
            <button class="feedback-button" data-value="3">😐</button>
            <button class="feedback-button" data-value="4">🙂</button>
            <button class="feedback-button" data-value="5">😍</button>
        </div>
        <p id="feedback-response" class="mt-3"></p>
    </div> -->
    <!-- Design Review Modal -->
    <div class="modal fade" id="designReviewModal" tabindex="-1" aria-labelledby="designReviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="designReviewModalLabel">Request a Design Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="design-review-form" method="post" enctype="multipart/form-data">
                        <input type="hidden" id="completeness-score" name="completeness-score">
                        <input type="hidden" id="skill-level-score" name="skill-level-score">
                        <input type="hidden" id="application-status-score" name="application-status-score">
                        <input type="hidden" id="use-case-score" name="use-case-score">
                        <input type="hidden" id="data-volume-score" name="data-volume-score">
                        <input type="hidden" id="uptime-sla-score" name="uptime-sla-score">
                        <input type="hidden" id="previous-interaction-score" name="previous-interaction-score">
                        <input type="hidden" id="total-score" name="total-score">
                        <div class="mb-3">
                            <label for="full-name" class="form-label">Full Name *</label>
                            <input type="text" class="form-control" id="full-name" name="full-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="company-name" class="form-label">Company Name *</label>
                            <input type="text" class="form-control" id="company-name" name="company-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="application-status" class="form-label">What is the Application/Workload’s status: *</label>
                            <select class="form-select" id="application-status" name="application-status" required>
                                <option value="In design phase">In design phase</option>
                                <option value="In production">In production</option>
                                <option value="Not started">Not started</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="model-ready" class="form-label">Do you have a logical model, relational schema or draft document model ready to discuss in this session? *</label>
                            <input type="text" class="form-control" id="model-ready" name="model-ready" required>
                        </div>
                        <div class="mb-3">
                            <label for="project-description" class="form-label">Project name and short description (business function, tech stack and immediate challenges) *</label>
                            <textarea class="form-control" id="project-description" name="project-description" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="skill-level" class="form-label">What is your MongoDB skill level? *</label>
                            <select class="form-select" id="skill-level" name="skill-level" required>
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Expert">Expert</option>
                                <option value="Never used before">Never used before</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="requirements" class="form-label">Please let us know any requirements you have relevant to your use case (future or current requirements): *</label>
                            <select class="form-select" id="requirements" name="requirements" multiple required>
                                <option value="Transactional guarantees">Transactional guarantees</option>
                                <option value="Full-Text Search">Full-Text Search</option>
                                <option value="Cross-Region HA">Cross-Region HA</option>
                                <option value="Cloud to on-prem replication">Cloud to on-prem replication (or vice versa)</option>
                                <option value="Time series capabilities">Time series capabilities</option>
                                <option value="Data tiering Sharing">Data tiering Sharing (horizontal scaling)</option>
                                <option value="Multi-cloud">Multi-cloud</option>
                                <option value="Data modeling guidance">Data modeling guidance</option>
                                <option value="Development assistance/guidance">Development assistance/guidance</option>
                                <option value="Edge database">Edge database (mobile or otherwise)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="data-size" class="form-label">Please share an estimate of the size of existing application data (GB/TB/PB) currently in production or estimated size in year 1: *</label>
                            <input type="text" class="form-control" id="data-size" name="data-size" required>
                        </div>
                        <div class="mb-3">
                            <label for="uptime-sla" class="form-label">Any uptime SLAs this application needs guaranteed? *</label>
                            <textarea class="form-control" id="uptime-sla" name="uptime-sla" rows="2" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="cloud-provider" class="form-label">What cloud provider will this application be deployed in? *</label>
                            <input type="text" class="form-control" id="cloud-provider" name="cloud-provider" required>
                        </div>
                        <div class="mb-3">
                            <label for="team-members" class="form-label">Is there anyone else from your team here today that you would like to be included in the session? *</label>
                            <textarea class="form-control" id="team-members" name="team-members" rows="2" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="team-goals" class="form-label">Could you provide further details on what goals your team is pursuing, if they haven't been covered already? *</label>
                            <textarea class="form-control" id="team-goals" name="team-goals" rows="2" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="sample-documents" class="form-label">Sample Documents</label>
                            <input type="file" class="form-control" id="sample-documents" name="sample-documents" multiple>
                        </div>
                        <div class="mb-3">
                            <label for="sample-queries" class="form-label">Sample Queries</label>
                            <input type="file" class="form-control" id="sample-queries" name="sample-queries" multiple>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var bookReviewBtn = document.getElementById('book-review-btn');
            var calendlyModal = new bootstrap.Modal(document.getElementById('calendlyModal'));

            bookReviewBtn.addEventListener('click', function () {
                calendlyModal.show();
            });
            var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'))
            var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
            return new bootstrap.Dropdown(dropdownToggleEl)
            })
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const moduleSelect = document.getElementById('module-select');
            const moduleItems = document.querySelectorAll('.dropdown-item');
            const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
            console.log('DOM fully loaded and parsed');

            console.log('moduleSelect:', moduleSelect);
            console.log('moduleItems:', moduleItems);

            moduleItems.forEach(item => {
                console.log('Attaching event listener to:', item);
                item.addEventListener('click', function(event) {
                    event.preventDefault();
                    const selectedModule = this.getAttribute('data-value');
                    console.log('Module selected:', selectedModule);
                    moduleSelect.textContent = this.textContent;
                    moduleItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
        });
    </script>
    <script src="{{ url_for('static', filename='js/chat.js') }}" defer></script>

</body>
</html>
